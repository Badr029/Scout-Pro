<div class="app-container">
  <aside class="left-sidebar" [class.expanded]="sidebarExpanded" (mouseenter)="expandSidebar()" (mouseleave)="collapseSidebar()">
    <div class="logo">{{ sidebarExpanded ? 'Scout Pro' : 'SP' }}</div>
    <nav class="nav-links">
      <a routerLink="/home" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
        <i class="bi bi-house-fill"></i>
        <span>Home</span>
      </a>
      <a href="#" class="search-link" [class.active]="showSearchPanel" (click)="toggleSearchPanel(); $event.preventDefault()">
        <i class="bi bi-search"></i>
        <span>Search</span>
      </a>
      <a href="#">
        <i class="bi bi-bell"></i>
        <span>Notifications</span>
      </a>
      <a href="#" *ngIf="isPlayer" (click)="openUploadModal(); $event.preventDefault()">
        <i class="bi bi-plus-square"></i>
        <span>Upload</span>
      </a>
      <a href="#" *ngIf="isScout" (click)="toggleFeedFilter(); $event.preventDefault()" [class.active]="showFeedFilter">
        <i class="bi bi-funnel"></i>
        <span>Filter Feed</span>
      </a>
      <div class="profile-menu-container">
        <a href="#" (click)="toggleAccountMenu($event)" class="profile-link" [class.active]="showAccountMenu">
          <img [src]="currentUser?.profile_image || getAvatarUrl(currentUser?.name?.split(' ')[0], currentUser?.name?.split(' ')[1])"
               [alt]="currentUser?.name"
               class="avatar-xs"
               (error)="handleImageError($event, currentUser?.name?.split(' ')[0], currentUser?.name?.split(' ')[1])" />
          <span>{{ currentUser?.name || 'Profile' }}</span>
        </a>
        <div class="account-menu" [class.show]="showAccountMenu">
          <div class="menu-item" (click)="goToProfile()">
            <i class="bi bi-person"></i>
            <span>View Profile</span>
          </div>
          <div class="menu-divider"></div>
          <div class="menu-item" (click)="logout()">
            <i class="bi bi-box-arrow-right"></i>
            <span>Logout</span>
          </div>
        </div>
      </div>
      <button class="menu-toggle" (click)="toggleRightPanel()" *ngIf="isMobile">
        <i class="bi" [class.bi-x-lg]="showRightPanel" [class.bi-list]="!showRightPanel"></i>
      </button>
    </nav>
  </aside>

  <!-- Search Panel -->
  <div class="search-panel" [class.active]="showSearchPanel">
    <div class="search-header">
      <h2>Search</h2>
      <button class="close-btn" (click)="toggleSearchPanel()">&times;</button>
    </div>

    <div class="search-form">
      <div class="search-input-container">
        <i class="bi bi-search"></i>
        <input
          type="text"
          placeholder="Search players by name or position..."
          class="search-input"
          [(ngModel)]="searchQuery"
          (keyup)="onSearchInput($event)"
          (keyup.enter)="onSearch()"
        />
        <button *ngIf="searchQuery" class="clear-search" (click)="clearSearch()">
          <i class="bi bi-x"></i>
        </button>

        <!-- Position Suggestions Dropdown -->
        <div class="position-suggestions" *ngIf="showPositionSuggestions && filteredPositions.length > 0">
          <div
            *ngFor="let position of filteredPositions; let i = index"
            class="position-suggestion-item"
            [class.active]="i === selectedSuggestionIndex"
            (click)="selectPosition(position)"
            (mouseenter)="selectedSuggestionIndex = i">
            {{ position }}
          </div>
        </div>
      </div>

      <!-- Recent Searches -->
      <div class="recent-searches">
        <h4>Recent Searches</h4>
        <div class="recent-search-items">
          <div *ngIf="recentSearches && recentSearches.length > 0">
            <button
              *ngFor="let search of recentSearches"
              class="recent-search-item">
              <div class="search-text" (click)="searchForTerm(search)">
                <i class="bi bi-clock-history"></i>
                {{ search }}
              </div>
              <i class="bi bi-x-circle delete-search" (click)="$event.stopPropagation(); deleteRecentSearch(search)"></i>
            </button>
          </div>
          <div *ngIf="!recentSearches || recentSearches.length === 0" class="no-searches">
            No recent searches
          </div>
        </div>
      </div>

      <!-- Scout Filters -->

      <div class="advanced-filters" [class.active]="showFilters && isScout">
        <div class="filter-container">
          <!-- Age Range Filter -->
          <div class="filter-group">
            <label>Age Range</label>
            <select [(ngModel)]="filters.age_range" (change)="onFilterChange('age_range', filters.age_range)">
              <option value="">All Ages</option>
              <option *ngFor="let range of feedData?.filter_options?.age_ranges" [value]="range.value">
                {{ range.label }}
              </option>
            </select>
          </div>

          <!-- Preferred Foot Filter -->
          <div class="filter-group">
            <label>Preferred Foot</label>
            <select [(ngModel)]="filters.preferred_foot" (change)="onFilterChange('preferred_foot', filters.preferred_foot)">
              <option value="">Any</option>
              <option *ngFor="let foot of feedData?.filter_options?.preferred_foot" [value]="foot.value">
                {{ foot.label }}
              </option>
            </select>
          </div>

          <!-- Region Filter -->
          <div class="filter-group">
            <label>Region</label>
            <select [(ngModel)]="filters.region" (change)="onFilterChange('region', filters.region)">
              <option value="">All Regions</option>
              <option *ngFor="let region of feedData?.filter_options?.regions" [value]="region.value">
                {{ region.label }}
              </option>
            </select>
          </div>

          <!-- Transfer Status Filter -->
          <div class="filter-group">
            <label>Transfer Status</label>
            <select [(ngModel)]="filters.transfer_status" (change)="onFilterChange('transfer_status', filters.transfer_status)">
              <option value="">Any Status</option>
              <option *ngFor="let status of feedData?.filter_options?.transfer_status" [value]="status.value">
                {{ status.label }}
              </option>
            </select>
          </div>
        </div>

        <!-- Suggested Roles -->
        <div class="suggested-roles" *ngIf="feedData?.filter_options?.suggested_roles?.length">
          <h4>Suggested Roles</h4>
          <div class="role-tags">
            <span *ngFor="let role of feedData?.filter_options?.suggested_roles"
                  class="role-tag"
                  (click)="searchForTerm(role)">
              {{ role }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Searching...</p>
    </div>

    <!-- Search Results -->
    <div class="search-results" *ngIf="!loading && searchResults.length > 0">
      <div *ngFor="let result of searchResults" class="player-card" [ngClass]="{'scout-card': result.type === 'scout'}">
        <img [src]="result.profile_image || getAvatarUrl(result.first_name, result.last_name)"
             [alt]="result.first_name + ' ' + result.last_name"
             class="player-avatar"
             (error)="handleImageError($event, result.first_name, result.last_name)">
        <div class="player-info">
          <div class="player-header">
            <h3 class="clickable" (click)="result.id === currentUser?.id ? goToProfile() : (result.type === 'scout' ? goToScoutProfile(result.scout_id) : goToPlayerProfile(result.user_id))">
            {{ result.first_name }} {{ result.last_name }}
          </h3>
            <span class="subscription-badge premium" *ngIf="result.membership === 'premium'">
              Premium
            </span>
          </div>
          <div class="type-badge" [ngClass]="result.type">{{ result.type | titlecase }}</div>

          <!-- Player-specific info -->
          <ng-container *ngIf="result.type === 'player'">
            <div class="position">{{ result.position }}</div>
            <div class="meta">{{ result.nationality }} • {{ result.current_city }}</div>
          </ng-container>

          <!-- Scout-specific info -->
          <ng-container *ngIf="result.type === 'scout'">
            <div class="position">{{ result.position_title }}</div>
            <div class="organization">{{ result.organization }}</div>
            <div class="meta">{{ result.city }}, {{ result.country }}</div>
          </ng-container>
        </div>
        <button class="view-profile-btn" (click)="result.id === currentUser?.id ? goToProfile() : (result.type === 'scout' ? goToScoutProfile(result.scout_id) : goToPlayerProfile(result.user_id))">
          View Profile
        </button>
      </div>
    </div>

    <!-- No Results State -->
    <div class="no-results" *ngIf="searchQuery && searchResults.length === 0 && !loading">
      <i class="bi bi-search"></i>
      <p>No players or scouts found matching your search criteria</p>
    </div>
  </div>

  <!-- Main Feed Content -->
  <div class="feed-container">
    <!-- Loading and Error States -->
    <div *ngIf="loading" class="loading"><span class="spinner"></span> Loading feed...</div>
    <div *ngIf="error" class="error" aria-live="assertive">{{ error }}</div>
    <div *ngIf="notification" class="notification" aria-live="polite">{{ notification }}</div>

    <!-- Feed Filter Panel for Scouts -->
    <div class="feed-filter-panel" *ngIf="isScout && showFeedFilter">
      <div class="filter-header">
        <h3>Filter Feed</h3>
        <button class="close-btn" (click)="toggleFeedFilter()">&times;</button>
      </div>
      <div class="filter-container">
        <!-- Age Range Filter -->
        <div class="filter-group">
          <label>Age Range</label>
          <select [(ngModel)]="feedFilters.age_range"
                  (focus)="onSelectFocus('age')"
                  (keydown)="onSelectKeydown($event, 'age')">
            <option value="">All Ages</option>
            <option *ngFor="let range of filteredLists.ageRanges" [value]="range.value">
              {{ range.label }}
            </option>
          </select>
        </div>

        <!-- Preferred Foot Filter -->
        <div class="filter-group">
          <label>Preferred Foot</label>
          <select [(ngModel)]="feedFilters.preferred_foot"
                  (focus)="onSelectFocus('foot')"
                  (keydown)="onSelectKeydown($event, 'foot')">
            <option value="">Any</option>
            <option *ngFor="let foot of filteredLists.preferredFoot" [value]="foot.value">
              {{ foot.label }}
            </option>
          </select>
        </div>

        <!-- Region Filter -->
        <div class="filter-group">
          <label>Region</label>
          <select [(ngModel)]="feedFilters.region"
                  (focus)="onSelectFocus('region')"
                  (keydown)="onSelectKeydown($event, 'region')">
            <option value="">All Regions</option>
            <option *ngFor="let region of filteredLists.regions" [value]="region">
              {{ region }}
            </option>
          </select>
        </div>

        <!-- Position Filter -->
        <div class="filter-group">
          <label>Position</label>
          <select [(ngModel)]="feedFilters.position"
                  (focus)="onSelectFocus('position')"
                  (keydown)="onSelectKeydown($event, 'position')">
            <option value="">All Positions</option>
            <option *ngFor="let position of filteredLists.positions" [value]="position">
              {{ position }}
            </option>
          </select>
        </div>

        <!-- Transfer Status Filter -->
        <div class="filter-group">
          <label>Transfer Status</label>
          <select [(ngModel)]="feedFilters.transfer_status"
                  (focus)="onSelectFocus('status')"
                  (keydown)="onSelectKeydown($event, 'status')">
            <option value="">Any Status</option>
            <option *ngFor="let status of filteredLists.transferStatus" [value]="status.value">
              {{ status.label }}
            </option>
          </select>
        </div>

        <!-- Filter Actions -->
        <div class="filter-actions">
          <button class="apply-filters-btn" (click)="applyFeedFilters()">Apply Filters</button>
          <button class="clear-filters-btn" (click)="clearFeedFilters()">Clear Filters</button>
        </div>
      </div>
    </div>

    <!-- View Switcher -->
    <div *ngIf="feedData && !loading" class="view-switcher">
      <button [class.active]="activeView === 'feed'" (click)="switchView('feed')">
        <i class="bi bi-play-btn"></i> Feed
      </button>
      <button [class.active]="activeView === 'events'" (click)="switchView('events')">
        <i class="bi bi-calendar-event"></i> Events
      </button>
    </div>

    <!-- Feed Content -->
    <ng-container *ngIf="feedData">
      <!-- Feed View (Default) -->
      <div *ngIf="activeView === 'feed'" class="reels-container">
        <div *ngIf="!feedData?.posts?.data?.length" class="empty-feed">
          No videos to show. Try adjusting your filters or check back later!
        </div>

        <div *ngFor="let post of feedData?.posts?.data" class="reel-card">
          <div class="reel-header">
            <div class="reel-user" (click)="post?.user?.id === currentUser?.id ? goToProfile() : goToPlayerProfile(post?.user?.id)">
              <img [src]="getProfileImageUrl(post?.user?.profile_image)"
                   class="avatar-sm"
                   [alt]="post?.user?.full_name"
                   (error)="handleImageError($event, post?.user?.first_name, post?.user?.last_name)">
              <div class="reel-user-info">
                <div class="user-header">
                  <span class="username">{{ post?.user?.id === currentUser?.id ? 'You' : post?.user?.full_name }}</span>
                  <span class="subscription-badge premium" *ngIf="post?.user?.membership === 'premium'">
                    Premium
                  </span>
                </div>
                <span class="user-meta" *ngIf="post?.user?.player">{{ post?.user?.player?.position || 'No Position' }} • {{ post?.user?.player?.region || post?.user?.player?.nationality || 'No Region' }}</span>
              </div>
            </div>
            <button
              class="follow-btn"
              *ngIf="!post?.user?.isCurrentUser && post?.user?.user_type === 'player' && post?.user?.id !== currentUser?.id"
              (click)="followPlayer(post?.user?.id)"
              [class.following]="post?.user?.following">
              <i class="bi bi-check2" *ngIf="post?.user?.following"></i>
              {{ post?.user?.following ? 'Following' : 'Follow' }}
            </button>
          </div>

          <div class="reel-video">
            <video
                   #videoPlayer
                   controls
                   [poster]="post?.thumbnail || ''"
                   preload="metadata"
                   (play)="onVideoPlay($event, post?.id)"
                   (error)="onVideoError($event)">
              <source [src]="getVideoUrl(post?.file_path)" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>

          <div class="reel-actions">
            <button (click)="likePost(post?.id)" class="action-btn like-btn" [ngClass]="{'active': post?.has_liked}">
              <i class="bi" [ngClass]="{'bi-heart-fill': post?.has_liked, 'bi-heart': !post?.has_liked}"></i>
              <span class="action-count" *ngIf="userProfile?.membership === 'premium' || isScout" (click)="showLikesList(post?.id, $event)">{{ post?.likes_count || 0 }}</span>
            </button>
            <button (click)="toggleCommentBox(post?.id)" class="action-btn">
              <i class="bi bi-chat"></i>
              <span class="action-count" *ngIf="userProfile?.membership === 'premium' || isScout">{{ post?.comments_count || 0 }}</span>
            </button>
            <button class="action-btn" (click)="post?.user?.isCurrentUser ? goToProfile() : goToPlayerProfile(post?.user?.id)">
              <i class="bi bi-person"></i>
            </button>
            <div class="video-stats" *ngIf="userProfile?.membership === 'premium' || isScout">
            <div class="views-count">
              <i class="bi bi-eye"></i> {{ post?.views || 0 }}
              </div>
            </div>
            <div class="upgrade-prompt" *ngIf="userProfile?.membership === 'free' && !isScout">
              <button class="btn btn-upgrade" (click)="goToSubscription()">
                Upgrade to Premium to view analytics
              </button>
            </div>
          </div>

          <div class="reel-caption">
            <p>
              <span>
                <span class="username" (click)="post?.user?.isCurrentUser ? goToProfile() : goToPlayerProfile(post?.user?.id)">
                  {{ post?.user?.isCurrentUser ? 'You' : post?.user?.full_name }}
                </span>
                {{ post?.description }}
              </span>
            <span class="post-date">{{ post?.created_at | date }}</span>
            </p>
          </div>

          <!-- Comments Section -->
          <div class="reel-comments" *ngIf="post?.comments?.length > 0">
            <div *ngFor="let comment of post?.comments?.slice(0, 2)" class="comment">
              <div class="comment-header">
                <img [src]="getProfileImageUrl(comment.user?.profile_image)"
                     class="comment-avatar"
                     [alt]="comment.user?.full_name"
                     (error)="handleImageError($event, comment.user?.first_name, comment.user?.last_name)">
                <span class="comment-user" (click)="comment.user?.isCurrentUser ? goToProfile() : goToUserProfile(comment.user?.id)">
                  {{ comment.user?.isCurrentUser ? 'You' : comment.user?.full_name }}
              </span>
              </div>
              <span class="comment-text">{{ comment.content }}</span>
              <span class="comment-time">{{ comment.created_at | date:'short' }}</span>
            </div>
            <div *ngIf="post?.comments?.length > 2" class="view-more-comments" (click)="toggleCommentBox(post?.id)">
              View all {{ post?.comments?.length }} comments
            </div>
          </div>

          <!-- Comment Box -->
          <div class="comment-box" *ngIf="showCommentBox[post?.id]">
            <div class="all-comments">
              <div *ngFor="let comment of post?.comments" class="comment">
                <div class="comment-header">
                  <img [src]="getProfileImageUrl(comment.user?.profile_image)"
                       class="comment-avatar"
                       [alt]="comment.user?.full_name"
                       (error)="handleImageError($event, comment.user?.first_name, comment.user?.last_name)">
                  <span class="comment-user" (click)="comment.user?.isCurrentUser ? goToProfile() : goToUserProfile(comment.user?.id)">
                    {{ comment.user?.isCurrentUser ? 'You' : comment.user?.full_name }}
                  </span>
                </div>
                <span class="comment-text">{{ comment.content }}</span>
                <span class="comment-time">{{ comment.created_at | date:'short' }}</span>
              </div>
            </div>
            <div class="add-comment">
              <input
                type="text"
                placeholder="Add a comment..."
                [(ngModel)]="newComment"
                (keyup.enter)="postComment(post?.id)"
              >
              <button class="post-comment-btn" (click)="postComment(post?.id)">Post</button>
            </div>
          </div>
        </div>

        <div *ngIf="feedData.posts.data.length > 0 && feedData.posts.current_page < feedData.posts.last_page" class="load-more">
          <button class="btn btn-outline" (click)="loadMore()" [disabled]="loading">
            <span *ngIf="!loading">Load More</span>
            <span *ngIf="loading" class="spinner small"></span>
          </button>
        </div>
      </div>

      <!-- Events View -->
      <div *ngIf="activeView === 'events'" class="events-section">
        <!-- Premium Subscription Prompt for Free Members -->
        <div *ngIf="userProfile?.membership === 'free' && !isScout" class="premium-upgrade-prompt">
          <div class="upgrade-content">
            <h2>Upgrade to Premium to Access Events</h2>
            <div class="premium-benefits">
              <h3>Premium Membership Benefits:</h3>
              <ul>
                <li><i class="bi bi-calendar-check"></i> Access to all scouting events and tryouts</li>
                <li><i class="bi bi-graph-up"></i> Track your video performance analytics</li>
                <li><i class="bi bi-camera-video"></i> Unlimited video uploads</li>
                <li><i class="bi bi-star"></i> Premium badge on your profile</li>
              </ul>
            </div>
            <button class="btn btn-premium" (click)="goToSubscription()">
              Upgrade to Premium
            </button>
          </div>
        </div>

        <!-- Regular Events Content for Premium/Scout Users -->
        <ng-container *ngIf="userProfile?.membership === 'premium' || isScout">
          <!-- Request Event Form -->
          <div class="event-request-section" *ngIf="userProfile?.membership === 'scout' || isScout">
            <button class="request-event-btn" (click)="toggleEventForm()" *ngIf="!showEventForm">
              Request New Event
            </button>
          </div>

          <!-- Event Request Form -->
          <div class="event-form-container" *ngIf="showEventForm" >
            <div class="form-header">
              <h2>Request New Event</h2>
              <button class="close-btn" (click)="toggleEventForm()">
                <i class="bi bi-x-lg"></i>
              </button>
            </div>

            <form [formGroup]="eventForm" (ngSubmit)="onSubmitEvent()" class="event-form">
              <!-- Event Title -->
              <div class="form-group">
                <label for="title">Event Title *</label>
                <input
                  type="text"
                  id="title"
                  formControlName="title"
                  placeholder="e.g. Cairo U21 Tryout – July 2025"
                  [class.is-invalid]="eventForm.get('title')?.invalid && eventForm.get('title')?.touched"
                >
                <div class="error-message" *ngIf="eventForm.get('title')?.invalid && eventForm.get('title')?.touched">
                  <span *ngIf="eventForm.get('title')?.errors?.['required']">Title is required</span>
                  <span *ngIf="eventForm.get('title')?.errors?.['minlength']">Title must be at least 5 characters</span>
                </div>
              </div>

              <!-- Date and Time -->
              <div class="form-row">
                <div class="form-group">
                  <label for="date">Date *</label>
                  <input
                    type="date"
                    id="date"
                    formControlName="date"
                    [class.is-invalid]="eventForm.get('date')?.invalid && eventForm.get('date')?.touched"
                  >
                  <div class="error-message" *ngIf="eventForm.get('date')?.invalid && eventForm.get('date')?.touched">
                    Date is required
                  </div>
                </div>

                <div class="form-group">
                  <label for="time">Time *</label>
                  <input
                    type="time"
                    id="time"
                    formControlName="time"
                    [class.is-invalid]="eventForm.get('time')?.invalid && eventForm.get('time')?.touched"
                  >
                  <div class="error-message" *ngIf="eventForm.get('time')?.invalid && eventForm.get('time')?.touched">
                    Time is required
                  </div>
                </div>
              </div>

              <!-- Location -->
              <div class="form-group">
                <label for="location">Location *</label>
                <div class="location-input-group">
                  <input
                    type="text"
                    id="location"
                    formControlName="location"
                    placeholder="Enter event location or paste Google Maps link"
                    [class.is-invalid]="eventForm.get('location')?.invalid && eventForm.get('location')?.touched"
                  >
                  <a *ngIf="locationLink" [href]="locationLink" target="_blank" class="maps-link">
                    <i class="bi bi-map"></i>
                    Open in Google Maps
                  </a>
                </div>
                <div class="error-message" *ngIf="eventForm.get('location')?.invalid && eventForm.get('location')?.touched">
                  Location is required
                </div>
              </div>

              <!-- Description -->
              <div class="form-group">
                <label for="description">Description</label>
                <textarea
                  id="description"
                  formControlName="description"
                  rows="4"
                  placeholder="Include event goals, age range, how to register, and other important details"
                ></textarea>
              </div>

              <!-- Image Upload -->
              <div class="form-group">
                <label for="image">Event Poster</label>
                <div class="image-upload-container">
                  <input
                    type="file"
                    id="image"
                    (change)="onEventImageSelected($event)"
                    accept="image/jpeg,image/png"
                    class="file-input"
                  >
                  <label for="image" class="upload-label">
                    <i class="bi bi-cloud-upload"></i>
                    <span>Choose Image</span>
                    <small>Supported: JPG, PNG (Max 5MB)</small>
                  </label>

                  <!-- Image Preview -->
                  <div class="image-preview" *ngIf="eventImagePreview">
                    <img [src]="eventImagePreview" alt="Event poster preview">
                    <button type="button" class="remove-image" (click)="selectedEventImage = null; eventImagePreview = null">
                      <i class="bi bi-x-circle"></i>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Organizer Contact -->
              <div class="form-group">
                <label for="organizer_contact">Contact Email *</label>
                <input
                  type="email"
                  id="organizer_contact"
                  formControlName="organizer_contact"
                  placeholder="Enter contact email for inquiries"
                  [class.is-invalid]="eventForm.get('organizer_contact')?.invalid && eventForm.get('organizer_contact')?.touched"
                >
                <div class="error-message" *ngIf="eventForm.get('organizer_contact')?.invalid && eventForm.get('organizer_contact')?.touched">
                  <span *ngIf="eventForm.get('organizer_contact')?.errors?.['required']">Contact email is required</span>
                  <span *ngIf="eventForm.get('organizer_contact')?.errors?.['email']">Please enter a valid email address</span>
                </div>
              </div>

              <!-- Target Audience -->
              <div class="form-group">
                <label>Target Audience *</label>
                <div class="audience-options">
                  <label class="radio-label">
                    <input type="radio" formControlName="target_audience" value="players">
                    <span>Players</span>
                  </label>
                  <label class="radio-label">
                    <input type="radio" formControlName="target_audience" value="scouts">
                    <span>Scouts</span>
                  </label>
                  <label class="radio-label">
                    <input type="radio" formControlName="target_audience" value="public">
                    <span>Public</span>
                  </label>
                </div>
              </div>

              <!-- Submit Button -->
              <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="toggleEventForm()">Cancel</button>
                <button type="submit" class="btn btn-primary" [disabled]="eventForm.invalid || isSubmittingEvent">
                  <span *ngIf="!isSubmittingEvent">Submit Request</span>
                  <span *ngIf="isSubmittingEvent">
                    <i class="bi bi-spinner spinning"></i>
                    Submitting...
                  </span>
                </button>
              </div>
            </form>
          </div>

          <!-- Pending Events Section -->
          <div class="pending-events-section" *ngIf="hasPendingEvents()">
            <h3>Your Pending Events</h3>
            <div class="events-grid">
              <div *ngFor="let event of getPendingEvents()"
                   class="event-card event-pending"
                   (click)="goToEvent(event)">
                <div class="event-image">
                  <img [src]="event.image || 'assets/default-event.jpg'" alt="{{ event.title }}">
                  <div class="event-date-badge">
                    {{ event.date | date:'MMM dd' }} {{ getEventDateTime(event.date) }}
                  </div>
                  <div class="event-status">Pending</div>
                </div>
                <div class="event-details">
                  <h3>{{ event.title }}</h3>
                  <p>{{ event.description }}</p>
                  <p class="event-location">
                    <i class="bi bi-geo-alt-fill"></i> {{ event.location }}
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Approved Events Section -->
          <div class="approved-events-section">
            <h3>Upcoming Events</h3>
            <!-- Events List -->
            <div *ngIf="!feedData.upcoming_events?.length" class="empty-feed">
              No upcoming events. Check back later for new opportunities!
            </div>
            <div class="events-grid">
              <div *ngFor="let event of getApprovedEvents()"
                   class="event-card"
                   (click)="goToEvent(event)">
                <div class="event-image">
                  <img [src]="event.image || 'assets/default-event.jpg'" alt="{{ event.title }}">
                  <div class="event-date-badge">
                    {{ event.date | date:'MMM dd' }} {{ getEventDateTime(event.date) }}
                  </div>
                </div>
                <div class="event-details">
                  <h3>{{ event.title }}</h3>
                  <p>{{ event.description }}</p>
                  <p class="event-location">
                    <i class="bi bi-geo-alt-fill"></i> {{ event.location }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </ng-container>
  </div>

  <!-- Right Panel -->
  <aside class="right-panel" [class.show]="showRightPanel">
    <div class="right-panel-header">
      <button class="right-panel-close" (click)="toggleRightPanel()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    <div class="right-panel-content">
      <div class="profile-info">
        <a href="#" (click)="goToProfile(); $event.preventDefault()" class="profile-link">
          <img [src]="currentUser?.profile_image || getAvatarUrl(currentUser?.name?.split(' ')[0], currentUser?.name?.split(' ')[1])"
               [alt]="currentUser?.name"
               class="avatar"
               (error)="handleImageError($event, currentUser?.name?.split(' ')[0], currentUser?.name?.split(' ')[1])" />
          <div class="profile-name">{{ currentUser?.name || 'Profile' }}</div>
        </a>
      </div>

      <div class="trending">
        <h4>Trending Players</h4>
        <div class="trending-list">
          <div *ngFor="let player of feedData?.trending_players"
               class="trending-item"
               (click)="player?.id === currentUser?.id ? goToProfile() : goToPlayerProfile(player?.id)">
            <img [src]="getProfileImageUrl(player?.profile_image)"
                 class="avatar-sm"
                 [alt]="player?.name"
                 (error)="handleImageError($event, player?.name?.split(' ')[0], player?.name?.split(' ')[1])">
            <div class="trending-info">
              <span class="trending-name">{{ player?.id === currentUser?.id ? 'You' : player?.name }}</span>
              <span class="trending-meta">{{ player?.position || 'No Position' }} • {{ player?.region || 'No Region' }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right panel events section -->
      <div class="right-panel-events">
        <div class="right-panel-events-header">
          <h4>Upcoming Events</h4>
          <button class="btn btn-outline" (click)="switchView('events'); $event.preventDefault()">See all</button>
        </div>

        <!-- Premium Upgrade Prompt for Free Members -->
        <div *ngIf="userProfile?.membership === 'free' && !isScout" class="right-panel-premium-prompt">
          <div class="premium-content">
            <h4>Upgrade to Premium to Access Events</h4>
            <p>Upgrade to premium to view upcoming scouting events and tryouts.</p>
            <button class="btn btn-premium-small" (click)="goToSubscription()">
              Upgrade Now
            </button>
          </div>
        </div>

        <!-- Events List for Premium/Scout Users -->
        <ng-container *ngIf="userProfile?.membership === 'premium' || isScout">
          <div *ngIf="!getApprovedEvents()?.length" class="empty-feed">
            No upcoming events. Check back later for new opportunities!
          </div>

          <div *ngFor="let event of getApprovedEvents()?.slice(0, 3)"
               class="event-card-small"
               (click)="goToEvent(event)">
            <div class="event-image">
              <img [src]="event.image || 'assets/default-event.jpg'" alt="{{ event.title }}">
              <div class="event-date-badge">
                {{ event.date | date:'MMM dd' }} {{ getEventDateTime(event.date) }}
              </div>
            </div>
            <div class="event-details">
              <h4>{{ event.title }}</h4>
              <p class="event-location">
                <i class="bi bi-geo-alt-fill"></i> {{ event.location }}
              </p>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Recommendations (Only for Scouts) -->
      <div class="recommendations" *ngIf="isScout">
        <h4>You May Also Like</h4>
        <div class="recommendation-list">
          <div *ngFor="let player of premiumPlayers" class="recommendation-item" (click)="goToPlayerProfile(player?.id)">
            <img [src]="player?.image || getAvatarUrl(player?.name?.split(' ')[0], player?.name?.split(' ')[1])"
                 class="avatar-sm"
                 [alt]="player?.name"
                 (error)="handleImageError($event, player?.name?.split(' ')[0], player?.name?.split(' ')[1])">
            <div class="recommendation-info">
              <span class="recommendation-name">{{ player?.name || 'Unknown Player' }}</span>
              <span class="recommendation-meta">{{ player?.position || 'No Position' }} • {{ player?.region || 'No Region' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </aside>
</div>

<!-- Video Upload Modal -->
<div class="modal" [class.show]="uploadModalOpen">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Upload New Video</h2>
      <button class="close" (click)="closeUploadModal()">&times;</button>
    </div>
    <div class="modal-body">
      <!-- Upload Form -->
      <div class="upload-form">
        <div class="form-group">
          <label for="title">Title (optional)</label>
          <input type="text"
                 id="title"
                 [(ngModel)]="uploadData.title"
                 class="form-control"
                 placeholder="Video title">
        </div>

        <div class="form-group">
          <label for="description">Description (optional)</label>
          <textarea id="description"
                    [(ngModel)]="uploadData.description"
                    class="form-control"
                    rows="3"
                    placeholder="Video description"></textarea>
        </div>

        <div class="form-group">
          <label for="video">Video File</label>
          <input type="file"
                 id="video"
                 (change)="onFileSelected($event)"
                 class="form-control"
                 accept="video/*">

        </div>

        <!-- Upload Progress -->
        <div *ngIf="uploadProgress > 0" class="upload-progress">
          <div class="progress-bar" [style.width.%]="uploadProgress"></div>
          <span>{{ uploadProgress }}%</span>
        </div>

        <!-- Error Message -->
        <p *ngIf="uploadError" class="error-message">{{ uploadError }}</p>

        <!-- Upload Limit Info -->
        <div *ngIf="userProfile?.membership === 'free'" class="upload-limit-info" [class.limit-reached]="userProfile?.monthly_video_count >= 2">
          <p class="info-text">Free Account Limits:</p>
          <p>You have {{ 2 - (userProfile?.monthly_video_count || 0) }}/2 video uploads available this month.</p>
          <p *ngIf="userProfile?.monthly_video_count >= 2" class="warning-text">
            You have reached your monthly upload limit.
            <a (click)="goToSubscription()" class="upgrade-link">Upgrade to Premium</a> for unlimited uploads.
          </p>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-outline" (click)="closeUploadModal()">Cancel</button>
      <button class="btn btn-primary"
              (click)="uploadVideo()"
              [disabled]="!uploadData.file || (userProfile?.membership === 'free' && userProfile?.monthly_video_count >= 2)">
        Upload
      </button>
    </div>
  </div>
</div>

<!-- Likes List Modal -->
<div class="modal" [class.show]="showLikesModal">
  <div class="modal-content likes-modal">
    <div class="modal-header">
      <h2>Likes</h2>
      <span class="close" (click)="closeLikesModal()">&times;</span>
    </div>
    <div class="modal-body">
      <div class="likes-list">
        <div *ngFor="let like of selectedPostLikes" class="like-item">
          <div class="like-user" (click)="like?.user?.id === currentUser?.id ? goToProfile() : (like?.user?.user_type === 'scout' ? goToScoutProfile(like?.user?.id) : goToPlayerProfile(like?.user?.id))">
            <img [src]="like?.user?.profile_image || getAvatarUrl(like?.user?.first_name, like?.user?.last_name)"
                 class="avatar-sm"
                 [alt]="like?.user?.full_name"
                 (error)="handleImageError($event, like?.user?.first_name, like?.user?.last_name)">
            <div class="user-info">
              <div class="user-name">{{ like?.user?.full_name }}</div>
              <div class="user-details" *ngIf="like?.user?.user_type === 'player' && like?.user?.player">
                <span class="position">Player - {{ like?.user?.player?.position }}</span>
              </div>
              <div class="user-details" *ngIf="like?.user?.user_type === 'scout'">
                <span class="role">Scout {{ like?.user?.role }}</span>
              </div>
            </div>
          </div>
          <div class="action-buttons" *ngIf="like?.user?.id !== currentUser?.id">
            <button class="follow-btn"
                    (click)="followPlayer(like?.user?.id)"
                    [class.following]="like?.user?.following">
            {{ like?.user?.following ? 'Following' : 'Follow' }}
          </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Mobile Overlay -->
<div class="mobile-overlay" [class.show]="showRightPanel" (click)="closeRightPanel()"></div>

<style>
.premium-upgrade-prompt {
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  border-radius: 12px;
  padding: 2rem;
  text-align: center;
  margin: 2rem auto;
  max-width: 600px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
}

.upgrade-content {
  color: #fff;
}

.upgrade-content h2 {
  font-size: 2rem;
  margin-bottom: 1.5rem;
  color: #fff;
}

.premium-benefits {
  text-align: left;
  margin: 2rem 0;
}

.premium-benefits h3 {
  font-size: 1.2rem;
  margin-bottom: 1rem;
  color: #ffd700;
}

.premium-benefits ul {
  list-style: none;
  padding: 0;
}

.premium-benefits li {
  margin: 1rem 0;
  font-size: 1.1rem;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.premium-benefits i {
  color: #ffd700;
  font-size: 1.2rem;
}

.btn-premium {
  background: linear-gradient(45deg, #ffd700, #ffa500);
  color: #1a1a2e;
  border: none;
  padding: 1rem 2rem;
  font-size: 1.2rem;
  border-radius: 30px;
  font-weight: bold;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin: 0 auto;
  cursor: pointer;
  transition: transform 0.2s;
}

.btn-premium:hover {
  transform: translateY(-2px);
}

.right-panel-premium-prompt {
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  border-radius: 8px;
  padding: 1.5rem;
  text-align: center;
  margin: 1rem 0;
}

.premium-content {
  color: #fff;
}

.premium-content i {
  font-size: 2rem;
  color: #ffd700;
  margin-bottom: 1rem;
}

.premium-content h4 {
  font-size: 1.2rem;
  margin-bottom: 0.5rem;
  color: #fff;
}

.premium-content p {
  font-size: 0.9rem;
  margin-bottom: 1rem;
  color: #ccc;
}

.btn-premium-small {
  background: linear-gradient(45deg, #ffd700, #ffa500);
  color: #1a1a2e;
  border: none;
  padding: 0.5rem 1rem;
  font-size: 0.9rem;
  border-radius: 20px;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.2s;
}

.btn-premium-small:hover {
  transform: translateY(-2px);
}
</style>
