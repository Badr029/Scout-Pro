<div class="app-container">
  <aside class="left-sidebar">
    <div class="logo">Scout Pro</div>
    <nav class="nav-links">
      <a href="#" class="active"><i class="bi bi-house-fill"></i> Home</a>
      <a href="#" class="search-link" (click)="toggleSearchPanel(); $event.preventDefault()"><i class="bi bi-search"></i> Search</a>
      <a href="#"><i class="bi bi-bell"></i> Notifications</a>
      <a href="#" (click)="openUploadModal(); $event.preventDefault()"><i class="bi bi-plus-square"></i> Upload</a>
      <a href="/profile"><img [src]="userProfile?.profile_image || 'https://ui-avatars.com/api/?name=User&size=24'" alt="Profile" class="avatar-xs" /> Profile</a>
    </nav>
  </aside>

  <!-- Search Panel -->
  <div class="search-panel" [class.active]="showSearchPanel">
    <div class="search-header">
    <h2>Search</h2>
      <button class="close-btn" (click)="toggleSearchPanel()">&times;</button>
    </div>
    <div class="search-form">
      <div class="search-input-container">
        <input
          type="text"
          placeholder="Search players, positions, locations..."
          class="search-input"
          [(ngModel)]="searchQuery"
          (keyup.enter)="onSearch()"
        />
        <button *ngIf="searchQuery" class="clear-search" (click)="clearSearch()">&times;</button>
        <button class="search-button" (click)="onSearch()"><i class="bi bi-search"></i></button>
      </div>
      <div class="filter-toggle" (click)="toggleFilter()">
        <span><i class="bi bi-funnel"></i> Filters</span>
        <span class="toggle-indicator" [class.active]="showFilters">▼</span>
      </div>

      <!-- Advanced Filters -->
      <div class="advanced-filters" [class.active]="showFilters">
        <div *ngIf="feedData?.filter_options" class="filter-container">
          <div *ngFor="let filter of feedData.filter_options" class="filter-group">
            <label>{{ filter.label }}</label>
            <select [(ngModel)]="filters[filter.key]" (change)="onFilterChange(filter.key, filters[filter.key])">
              <option *ngFor="let option of filter.options" [value]="option.value">{{ option.label }}</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="search-suggestions">
      <h4>Suggested Searches</h4>
      <div class="tag-container">
        <div *ngFor="let tag of feedData?.suggested_searches" class="search-tag" (click)="searchForTerm(tag)">
          {{ tag }}
        </div>
      </div>
    </div>

    <div class="recent-searches">
      <h4>Recent</h4>
      <div class="search-history">
        <div class="recent-item">
          <span>Forward players in London</span>
          <button class="history-search-btn" (click)="searchForTerm('Forward London')"><i class="bi bi-search"></i></button>
        </div>
        <div class="recent-item">
          <span>Under 18 midfielders</span>
          <button class="history-search-btn" (click)="searchForTerm('Under 18 midfielders')"><i class="bi bi-search"></i></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Feed Content -->
  <div class="feed-container">
    <!-- Loading and Error States -->
    <div *ngIf="loading" class="loading"><span class="spinner"></span> Loading feed...</div>
    <div *ngIf="error" class="error" aria-live="assertive">{{ error }}</div>
    <div *ngIf="notification" class="notification" aria-live="polite">{{ notification }}</div>

    <!-- View Switcher -->
    <div *ngIf="feedData && !loading" class="view-switcher">
      <button [class.active]="activeView === 'reels'" (click)="switchView('reels')">
        <i class="bi bi-play-btn"></i> Reels
      </button>
      <button [class.active]="activeView === 'grid'" (click)="switchView('grid')">
        <i class="bi bi-grid-3x3"></i> Grid
      </button>
      <button [class.active]="activeView === 'events'" (click)="switchView('events')">
        <i class="bi bi-calendar-event"></i> Events
      </button>
    </div>

    <!-- Feed Content -->
    <ng-container *ngIf="feedData">
      <!-- Reels View (Default) -->
      <div *ngIf="activeView === 'reels'" class="reels-container">
        <div *ngIf="!feedData.posts.data.length" class="empty-feed">
          No videos to show. Try adjusting your filters or check back later!
        </div>

        <div *ngFor="let post of feedData.posts.data" class="reel-card">
          <div class="reel-header">
            <div class="reel-user" (click)="goToPlayerProfile(post.player.id)">
              <img [src]="post.player.profile_image || 'https://ui-avatars.com/api/?name=' + post.player.name" class="avatar-sm">
              <div class="reel-user-info">
                <span class="username">{{ post.player.name }}</span>
                <span class="user-meta">{{ post.player.position }} • {{ post.player.region }}</span>
              </div>
            </div>
            <button
              class="follow-btn"
              *ngIf="!post.player.following"
              (click)="followPlayer(post.player.id)"
            >Follow</button>
            <span class="following-label" *ngIf="post.player.following">
              <i class="bi bi-check2"></i> Following
            </span>
          </div>

          <div class="reel-video">
            <video controls [poster]="post.thumbnail" preload="metadata">
              <source [src]="post.video_url" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>

          <div class="reel-actions">
            <button (click)="likePost(post.id)" class="action-btn like-btn" [class.active]="post.liked">
              <i class="bi" [ngClass]="post.liked ? 'bi-heart-fill' : 'bi-heart'"></i>
              <span class="action-count">{{ post.likes }}</span>
            </button>
            <button (click)="toggleCommentBox(post.id)" class="action-btn">
              <i class="bi bi-chat"></i>
              <span class="action-count">{{ post.comments.length }}</span>
            </button>
            <button class="action-btn" (click)="goToPlayerProfile(post.player.id)">
              <i class="bi bi-person"></i>
            </button>
            <div class="views-count">
              <i class="bi bi-eye"></i> {{ post.views }}
            </div>
          </div>

          <div class="reel-caption">
            <p><span class="username">{{ post.player.name }}</span> {{ post.description }}</p>
            <span class="post-date">{{ post.created_at | date }}</span>
          </div>

          <!-- Comments Section -->
          <div class="reel-comments" *ngIf="post.comments.length > 0">
            <div *ngFor="let comment of post.comments.slice(0, 2)" class="comment">
              <span class="comment-user">{{ comment.user }}</span>
              <span class="comment-text">{{ comment.text }}</span>
              <span class="comment-time">{{ comment.timestamp }}</span>
            </div>
            <div *ngIf="post.comments.length > 2" class="view-more-comments" (click)="toggleCommentBox(post.id)">
              View all {{ post.comments.length }} comments
            </div>
          </div>

          <!-- Comment Box -->
          <div class="comment-box" *ngIf="showCommentBox[post.id]">
            <div class="all-comments">
              <div *ngFor="let comment of post.comments" class="comment">
                <span class="comment-user">{{ comment.user }}</span>
                <span class="comment-text">{{ comment.text }}</span>
                <span class="comment-time">{{ comment.timestamp }}</span>
              </div>
            </div>
            <div class="add-comment">
              <input
                type="text"
                placeholder="Add a comment..."
                [(ngModel)]="newComment"
                (keyup.enter)="postComment(post.id)"
              >
              <button class="post-comment-btn" (click)="postComment(post.id)">Post</button>
            </div>
          </div>
        </div>

        <div *ngIf="feedData.posts.data.length > 0 && feedData.posts.current_page < feedData.posts.last_page" class="load-more">
          <button class="btn btn-outline" (click)="loadMore()" [disabled]="loading">
            <span *ngIf="!loading">Load More</span>
            <span *ngIf="loading" class="spinner small"></span>
          </button>
        </div>
      </div>

      <!-- Grid View -->
      <div *ngIf="activeView === 'grid'" class="grid-container">
        <div *ngIf="!feedData.posts.data.length" class="empty-feed">
          No videos to show. Try adjusting your filters or check back later!
        </div>

        <div class="video-grid">
          <div *ngFor="let post of feedData.posts.data" class="grid-item" (click)="goToPlayerProfile(post.player.id)">
            <div class="grid-thumbnail">
              <img [src]="post.thumbnail || 'assets/default-thumbnail.jpg'" alt="{{ post.title }}">
              <div class="play-overlay">
                <span class="play-icon"><i class="bi bi-play-circle-fill"></i></span>
              </div>
              <div class="video-stats">
                <span><i class="bi bi-eye"></i> {{ post.views }}</span>
                <span><i class="bi bi-heart"></i> {{ post.likes }}</span>
              </div>
            </div>
            <div class="grid-info">
              <div class="grid-user">
                <img [src]="post.player.profile_image || 'https://ui-avatars.com/api/?name=' + post.player.name" class="avatar-xs">
                <span>{{ post.player.name }}</span>
              </div>
              <p class="grid-title">{{ post.title }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Events View -->
      <div *ngIf="activeView === 'events'" class="events-container">
        <div *ngIf="!feedData.upcoming_events?.length" class="empty-feed">
          No upcoming events. Check back later for new opportunities!
        </div>

        <div class="events-grid">
          <div *ngFor="let event of feedData.upcoming_events" class="event-card" (click)="goToEvent(event.id)">
            <div class="event-image">
              <img [src]="event.image || 'assets/default-event.jpg'" alt="{{ event.title }}">
              <div class="event-date-badge">
                {{ event.date | date:'MMM dd' }}
              </div>
            </div>
            <div class="event-details">
              <h3>{{ event.title }}</h3>
              <p class="event-location"><i class="bi bi-geo-alt"></i> {{ event.location }}</p>
              <p class="event-description">{{ event.desc }}</p>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Right Panel -->
  <aside class="right-panel">
    <div class="profile-info">
      <a href="/profile" class="profile-link">
        <img [src]="userProfile?.profile_image || 'https://ui-avatars.com/api/?name=User'" alt="Profile" class="avatar">
        <div class="profile-name">{{ userProfile?.username || 'username' }}</div>
      </a>
    </div>

    <div class="trending">
      <h4>Trending Players</h4>
      <div class="trending-list">
        <div *ngFor="let player of feedData?.trending_players" class="trending-item" (click)="goToPlayerProfile(player.id)">
          <img [src]="player.image || 'https://ui-avatars.com/api/?name=' + player.name" class="avatar-sm">
          <div class="trending-info">
            <span class="trending-name">{{ player.name }}</span>
            <span class="trending-meta">{{ player.position }} • {{ player.region }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="events">
      <div class="section-header">
      <h4>Upcoming Events</h4>
        <a href="#" (click)="switchView('events'); $event.preventDefault()" class="see-all">See all</a>
      </div>

      <div class="event-card" *ngFor="let event of feedData?.upcoming_events" (click)="goToEvent(event.id)">
        <div class="event-bg" [style.background-image]="'url(' + (event.image || 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80') + ')'">
          <div class="event-overlay">
            <div class="event-title">{{ event.title }}</div>
            <div class="event-date">{{ event.date | date }}</div>
            <div class="event-location"><i class="bi bi-geo-alt"></i> {{ event.location }}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="recommendations">
      <h4>You May Also Like</h4>
      <div class="recommendation-list">
        <div *ngFor="let rec of feedData?.recommendations" class="recommendation-item" (click)="goToPlayerProfile(rec.id)">
          <img [src]="rec.image || 'https://ui-avatars.com/api/?name=' + rec.name" class="avatar-sm">
          <div class="recommendation-info">
            <span class="recommendation-name">{{ rec.name }}</span>
            <span class="recommendation-meta">{{ rec.position }} • {{ rec.region }}</span>
          </div>
          <button class="btn btn-sm">View</button>
        </div>
      </div>
    </div>
  </aside>
</div>

<!-- Footer -->
<footer class="app-footer">
  <span>&copy; {{ currentYear }} ScoutPro. All rights reserved.</span>
</footer>

<!-- Video Upload Modal -->
<div class="modal" [class.show]="uploadModalOpen">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Upload New Video</h2>
      <span class="close" (click)="closeUploadModal()">&times;</span>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label for="title">Title:</label>
        <input type="text" id="title" [(ngModel)]="uploadData.title" class="form-control" placeholder="Video title">
      </div>
      <div class="form-group">
        <label for="description">Description:</label>
        <textarea id="description" [(ngModel)]="uploadData.description" class="form-control" rows="3" placeholder="Video description"></textarea>
      </div>
      <div class="form-group">
        <label for="video">Video File:</label>
        <input type="file" id="video" (change)="onFileSelected($event)" class="form-control" accept="video/*">
      </div>
      <div *ngIf="uploadProgress > 0" class="upload-progress">
        <div class="progress-bar" [style.width.%]="uploadProgress"></div>
        <span>{{ uploadProgress }}%</span>
      </div>
      <p *ngIf="uploadError" class="error-message">{{ uploadError }}</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" (click)="closeUploadModal()">Cancel</button>
      <button class="btn btn-primary" (click)="uploadVideo()">Upload</button>
    </div>
  </div>
</div>
