<div class="admin-layout">
  <!-- Left Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>Scout Pro Admin</h2>
    </div>

    <div class="sidebar-menu">
      <a class="menu-item" [class.active]="currentSection === 'statistics'" (click)="setSection('statistics')">
        <i class="fas fa-chart-line"></i>
        Statistics
      </a>
      <a class="menu-item" [class.active]="currentSection === 'contact-requests'" (click)="setSection('contact-requests')">
        <i class="fas fa-envelope"></i>
        Contact Requests
      </a>
      <a class="menu-item" [class.active]="currentSection === 'event-requests'" (click)="setSection('event-requests')">
        <i class="fas fa-calendar-plus"></i>
        Event Requests
      </a>
    </div>

    <div class="sidebar-footer">
      <button class="logout-btn" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i>
        Logout
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Statistics Section -->
    <div *ngIf="currentSection === 'statistics'">
      <div *ngIf="error" class="error-message">
        {{ error }}
        <button (click)="loadStats(); loadCharts()">Retry</button>
      </div>

      <div *ngIf="loading" class="loading-spinner">
        Loading dashboard data...
      </div>

      <div *ngIf="!loading && !error" class="dashboard-content">
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Total Users</h3>
            <p class="stat-number">{{ stats.totalUsers }}</p>
            <div class="stat-breakdown">
              <span>Players: {{ stats.totalPlayers }}</span>
              <span>Scouts: {{ stats.totalScouts }}</span>
            </div>
          </div>

          <div class="stat-card">
            <h3>Total Videos</h3>
            <p class="stat-number">{{ stats.totalVideos }}</p>
          </div>

          <div class="stat-card">
            <h3>Engagement</h3>
            <div class="stat-breakdown">
              <span>Likes: {{ stats.totalLikes }}</span>
              <span>Comments: {{ stats.totalComments }}</span>
              <span>Follows: {{ stats.totalFollows }}</span>
            </div>
          </div>
        </div>

        <div class="charts-grid">
          <div class="chart-container">
            <canvas id="userGrowthChart"></canvas>
          </div>

          <div class="chart-container">
            <canvas id="engagementChart"></canvas>
          </div>

          <div class="chart-container">
            <canvas id="videoStatsChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Contact Requests Section -->
    <div *ngIf="currentSection === 'contact-requests'" class="contact-requests">
      <h2>Contact Requests</h2>

      <div *ngIf="loadingRequests" class="loading-spinner">
        Loading contact requests...
      </div>

      <div *ngIf="requestError" class="error-message">
        {{ requestError }}
        <button (click)="loadContactRequests()">Retry</button>
      </div>

      <div *ngIf="successMessage" class="success-message">
        {{ successMessage }}
      </div>

      <div class="requests-grid">
        <div *ngFor="let request of contactRequests" class="request-card">
          <div class="request-header">
            <div class="status-badge" [class]="request.status">{{ request.status }}</div>
            <div class="request-date">{{ request.created_at | date:'medium' }}</div>
          </div>

          <div class="profiles-container">
            <div class="profile scout-profile">
              <img [src]="request.scout.profile?.profile_image || 'assets/default-avatar.png'" alt="Scout" class="profile-image">
              <div class="profile-info">
                <h3>{{ request.scout.name }}</h3>
                <p><i class="fas fa-building"></i> {{ request.scout.profile?.company || 'N/A' }}</p>
                <p><i class="fas fa-briefcase"></i> {{ request.scout.profile?.position || 'N/A' }}</p>
                <p><i class="fas fa-map-marker-alt"></i> {{ request.scout.profile?.region || 'N/A' }}</p>
              </div>
            </div>

            <div class="profile-divider">
              <i class="fas fa-arrow-right"></i>
            </div>

            <div class="profile player-profile">
              <img [src]="request.player.profile?.profile_image || 'assets/default-avatar.png'" alt="Player" class="profile-image">
              <div class="profile-info">
                <h3>{{ request.player.name }}</h3>
                <p><i class="fas fa-futbol"></i> {{ request.player.profile?.position || 'N/A' }}</p>
                <p><i class="fas fa-globe"></i> {{ request.player.profile?.nationality || 'N/A' }}</p>
                <p><i class="fas fa-map-marker-alt"></i> {{ request.player.profile?.current_city || 'N/A' }}</p>
              </div>
            </div>
          </div>

          <div class="request-message" *ngIf="request.message">
            <p><strong>Message:</strong></p>
            <p>{{ request.message }}</p>
          </div>

          <div class="request-actions" *ngIf="request.status === 'pending'">
            <button class="approve-btn" (click)="updateRequest(request.id, 'approved')">
              <i class="fas fa-check"></i> Approve
            </button>
            <button class="reject-btn" (click)="updateRequest(request.id, 'rejected')">
              <i class="fas fa-times"></i> Reject
            </button>
          </div>

          <div class="request-footer" *ngIf="request.status !== 'pending'">
            <p>
              <i class="fas" [class.fa-check-circle]="request.status === 'approved'" [class.fa-times-circle]="request.status === 'rejected'"></i>
              {{ request.status === 'approved' ? 'Approved' : 'Rejected' }} on {{ request.responded_at | date:'medium' }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Event Requests Section -->
    <div *ngIf="currentSection === 'event-requests'" class="event-requests">
      <h2>Event Requests</h2>

      <div *ngIf="loadingEvents" class="loading-spinner">
        Loading event requests...
      </div>

      <div *ngIf="eventError" class="error-message">
        {{ eventError }}
        <button (click)="loadEventRequests()">Retry</button>
      </div>

      <div *ngIf="eventSuccessMessage" class="success-message">
        {{ eventSuccessMessage }}
      </div>

      <div class="requests-grid">
        <div *ngFor="let event of eventRequests" class="request-card">
          <div class="request-header">
            <div class="status-badge" [class]="event.status">{{ event.status }}</div>
            <div class="request-date">{{ event.created_at | date:'medium' }}</div>
          </div>

          <div class="event-details">
            <h3>{{ event.title }}</h3>

            <div class="event-info">
              <p><i class="fas fa-calendar"></i> {{ event.date | date:'medium' }}</p>
              <p><i class="fas fa-map-marker-alt"></i> {{ event.location }}</p>
              <p><i class="fas fa-users"></i> Target: {{ event.target_audience }}</p>
              <p><i class="fas fa-envelope"></i> Contact: {{ event.organizer_contact }}</p>
            </div>

            <div class="organizer-info">

              <div class="profile-info">
                <h4>Organizer: {{ event.organizer?.name }}</h4>
                <p><i class="fas fa-building"></i> {{ event.organizer?.profile?.company || 'N/A' }}</p>
                <p><i class="fas fa-map-marker-alt"></i> {{ event.organizer?.profile?.region || 'N/A' }}</p>
              </div>
            </div>

            <div class="event-description" *ngIf="event.description">
              <p><strong>Description:</strong></p>
              <p>{{ event.description }}</p>
            </div>

            <div class="event-image" *ngIf="event.image">
              <img [src]="event.image" alt="Event image">
            </div>
          </div>

          <div class="request-actions" *ngIf="event.status === 'pending'">
            <button class="approve-btn" (click)="updateEventStatus(event.id, 'approved')">
              <i class="fas fa-check"></i> Approve
            </button>
            <button class="reject-btn" (click)="updateEventStatus(event.id, 'rejected')">
              <i class="fas fa-times"></i> Reject
            </button>
          </div>

          <div class="request-footer" *ngIf="event.status !== 'pending'">
            <p>
              <i class="fas" [class.fa-check-circle]="event.status === 'approved'"
                         [class.fa-times-circle]="event.status === 'rejected'"></i>
              {{ event.status === 'approved' ? 'Approved' : 'Rejected' }} on {{ event.responded_at | date:'medium' }}
            </p>
            <p *ngIf="event.rejection_reason" class="rejection-reason">
              <strong>Reason:</strong> {{ event.rejection_reason }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
